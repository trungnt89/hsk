<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Simple SW Notification</title>
</head>
<body>
    <h1>Service Worker Notification</h1>
    <button onclick="sendNotification()">Hiển thị Hello World</button>

    <script>
        if ('serviceWorker' in navigator) {
            // Thêm v=... để trình duyệt luôn nạp bản mới nhất của sw.js
            navigator.serviceWorker.register('sw.js?v=' + Date.now())
            .then(reg => console.log('SW đã sẵn sàng!', reg))
            .catch(err => console.error('Lỗi đăng ký SW:', err));
        }

        async function sendNotification() {
			// Kiểm tra xem trình duyệt có hỗ trợ Notification không
			if (!("Notification" in window)) {
				alert("Trình duyệt này không hỗ trợ thông báo.");
				return;
			}

			const permission = await Notification.requestPermission();
			
			if (permission === 'granted') {
				const registration = await navigator.serviceWorker.ready;
				if (registration.showNotification) {
					// Gọi trực tiếp từ registration để đảm bảo Mobile xử lý được
					registration.showNotification('Hello Mobile!', {
						body: 'Thông báo này đã được tối ưu cho điện thoại',
						badge: 'https://cdn-icons-png.flaticon.com/512/252/252035.png', // Icon nhỏ trên thanh trạng thái
						vibrate: [200, 100, 200] // Rung nhẹ trên Android
					});
				}
			} else {
				alert('Vui lòng cấp quyền thông báo trong cài đặt trình duyệt!');
			}
		}
    </script>
</body>
</html>