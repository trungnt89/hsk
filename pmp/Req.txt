https://script.google.com/macros/s/AKfycbz-CilJVS0UgOFRHtgF8fhaGA7IM8sNE4vOZYkvZugKp6XlyesS058QeFJbTZ4ZTA_q/exec

git add . ;  git commit -m "SRC change" ; git push;



ğŸ”³ğŸ”³ğŸ”³ğŸ”³ğŸ”³ğŸ”³ğŸ”³ğŸ”³ğŸ”³ğŸ”³ğŸ”³ğŸ”³ğŸ”³ğŸ”³ğŸ”³ğŸ”³ğŸ”³ğŸ”³ğŸ”³ğŸ”³
NGHIÃŠM Cáº¤M má»i hÃ nh vi sá»­a code ngoÃ i pháº¡m vi yÃªu cáº§u , sá»­ dá»¥ng git diff Ä‘á»ƒ check cho tÃ´i xem vÃ  phÃª duyá»‡t
chá»‰ thá»±c hiá»‡n yÃªu cáº§u dÆ°á»›i Ä‘Ã¢y, náº¿u báº¡n sá»­a src ngoÃ i pháº¡m vi yÃªu cáº§u tÃ´i sáº½ kiá»‡n báº¡n 
ğŸ”³ğŸ”³ğŸ”³ğŸ”³ğŸ”³ğŸ”³ğŸ”³ğŸ”³ğŸ”³ğŸ”³ğŸ”³ğŸ”³ğŸ”³ğŸ”³ğŸ”³ğŸ”³ğŸ”³ğŸ”³ğŸ”³ğŸ”³
1. LÆ°u láº¡i vÄ©nh cá»­u thÃ´ng tin url cá»§a gas Ä‘á»ƒ dÃ¹ng vá» sau  vÃ o indexdb
-------------------
Src gá»‘c cáº§n sá»­a:
-------------------
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Quáº£n trá»‹ IndexedDB - Sync Google Drive</title>
    <style>
        :root { --primary: #3498db; --view: #9b59b6; --export: #27ae60; --import: #f39c12; --clear: #e74c3c; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: #f0f2f5; padding: 20px; }
        .container { max-width: 1200px; margin: auto; }
        
        .header-box { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 20px; text-align: center; }
        #log { background: #1e1e1e; color: #00ff00; padding: 10px; border-radius: 8px; max-height: 80px; overflow-y: auto; font-family: monospace; font-size: 11px; margin-bottom: 20px; }
        
        .db-card { background: white; border-radius: 10px; padding: 20px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .store-item { border: 1px solid #e1e4e8; border-radius: 8px; margin-bottom: 10px; overflow: hidden; }
        .store-header { background: #f8f9fa; padding: 10px 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #e1e4e8; }
        
        .btn-group { display: flex; gap: 5px; }
        button { padding: 6px 12px; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 11px; color: white; transition: opacity 0.2s; }
        button:hover { opacity: 0.8; }
        .btn-scan { background: var(--primary); width: 100%; padding: 12px; font-size: 14px; margin-bottom: 20px; }
        .btn-view { background: var(--view); }
        .btn-export { background: var(--export); }
        .btn-import { background: var(--import); }
        .btn-clear { background: var(--clear); }

        .data-viewer { display: none; padding: 10px; background: #fff; max-height: 600px; overflow: auto; }
        table { width: 100%; border-collapse: collapse; font-size: 12px; table-layout: fixed; }
        th { background: #f1f3f5; position: sticky; top: 0; padding: 10px; border: 1px solid #dee2e6; z-index: 10; }
        td { border: 1px solid #dee2e6; padding: 8px; text-align: left; vertical-align: top; word-break: break-all; }
        .cell-key { font-weight: bold; color: #2c3e50; background: #fdfefe; width: 150px; }
        .cell-index { width: 40px; text-align: center; }
        .cell-blob { color: #7f8c8d; font-style: italic; display: block; margin-bottom: 5px; }
        
        pre.json-pretty { 
            background: #f8f9fa; 
            padding: 8px; 
            border-radius: 4px; 
            border: 1px solid #eee; 
            white-space: pre-wrap; 
            font-family: 'Consolas', monospace; 
            color: #d63384;
            margin: 0;
            max-height: 300px;
            overflow: auto;
        }
        
        .audio-ctrl { display: flex; flex-direction: column; gap: 5px; }
        audio { height: 30px; width: 100%; max-width: 250px; }
        .download-link { font-size: 11px; color: var(--primary); text-decoration: none; font-weight: bold; }

        .config-box { margin-bottom: 10px; text-align: left; font-size: 12px; }
        #scriptUrl { width: 100%; padding: 5px; margin-top: 5px; border: 1px solid #ccc; }
    </style>
</head>
<body>

<div class="container">
    <div class="header-box">
        <h2>ğŸ“Š TrÃ¬nh Quáº£n LÃ½ Dá»¯ Liá»‡u Audio & JSON Cache</h2>
        <div class="config-box">
            <label>Google Script Web App URL:</label>
            <input type="text" id="scriptUrl" placeholder="https://script.google.com/macros/s/.../exec">
        </div>
    </div>
    
    <div id="log">Sáºµn sÃ ng...</div>
    <button class="btn-scan" onclick="deepScan()">ğŸ”„ QUÃ‰T TOÃ€N Bá»˜ DATABASE</button>
    <div id="results"></div>
</div>

<script>
    const logEl = document.getElementById('log');
    const resultsEl = document.getElementById('results');
    const scriptUrlInput = document.getElementById('scriptUrl');

    function writeLog(msg) {
        const time = new Date().toLocaleTimeString();
        logEl.innerHTML += `<div>[${time}] > ${msg}</div>`;
        logEl.scrollTop = logEl.scrollHeight;
    }

    async function deepScan() {
        resultsEl.innerHTML = "";
        try {
            const dbs = await indexedDB.databases();
            if (dbs.length === 0) {
                writeLog("KhÃ´ng tÃ¬m tháº¥y Database nÃ o.");
                return;
            }
            dbs.forEach(dbInfo => renderDB(dbInfo.name));
            writeLog(`TÃ¬m tháº¥y ${dbs.length} Database.`);
        } catch (e) { writeLog("Lá»—i: TrÃ¬nh duyá»‡t khÃ´ng há»— trá»£ hoáº·c lá»—i quÃ©t danh sÃ¡ch DB."); }
    }

    function renderDB(dbName) {
        const req = indexedDB.open(dbName);
        req.onsuccess = (e) => {
            const db = e.target.result;
            const dbCard = document.createElement('div');
            dbCard.className = 'db-card';
            dbCard.innerHTML = `<div style="margin-bottom:10px"><b>ğŸ“‚ DB: ${dbName}</b></div>`;

            Array.from(db.objectStoreNames).forEach(sName => {
                const safeId = btoa(unescape(encodeURIComponent(dbName + sName))).replace(/[^a-z0-9]/gi, "");
                const storeDiv = document.createElement('div');
                storeDiv.className = 'store-item';
                storeDiv.innerHTML = `
                    <div class="store-header">
                        <span>ğŸ“¦ <b>${sName}</b></span>
                        <div class="btn-group">
                            <button class="btn-view" onclick="toggleView('${dbName}', '${sName}', '${safeId}')">ğŸ‘ï¸ View</button>
                            <button class="btn-export" onclick="syncToCloud('${dbName}', '${sName}')">ğŸ“¤ Sync to Cloud</button>
                            <button class="btn-import" onclick="syncFromCloud('${dbName}', '${sName}')">ğŸ“¥ Sync from Cloud</button>
                            <button class="btn-clear" onclick="clearData('${dbName}', '${sName}', '${safeId}')">ğŸ—‘ï¸ Clear</button>
                        </div>
                    </div>
                    <div class="data-viewer" id="view_${safeId}">
                        <table id="table_${safeId}">
                            <thead><tr><th class="cell-index">#</th><th class="cell-key">Key</th><th>Value (Content)</th></tr></thead>
                            <tbody></tbody>
                        </table>
                    </div>
                `;
                dbCard.appendChild(storeDiv);
            });
            resultsEl.appendChild(dbCard);
            db.close();
        };
    }

    function toggleView(dbName, storeName, safeId) {
        const viewer = document.getElementById(`view_${safeId}`);
        if (viewer.style.display === "block") {
            viewer.style.display = "none";
            return;
        }

        const tbody = document.getElementById(`table_${safeId}`).querySelector('tbody');
        tbody.innerHTML = "<tr><td colspan='3'>Äang táº£i dá»¯ liá»‡u...</td></tr>";
        viewer.style.display = "block";

        const req = indexedDB.open(dbName);
        req.onsuccess = (e) => {
            const db = e.target.result;
            const tx = db.transaction(storeName, "readonly");
            const store = tx.objectStore(storeName);
            const cursorReq = store.openCursor();
            
            tbody.innerHTML = "";
            let count = 0;

            cursorReq.onsuccess = (ev) => {
                const cursor = ev.target.result;
                if (cursor) {
                    count++;
                    const key = cursor.key;
                    const value = cursor.value;
                    const tr = document.createElement('tr');
                    
                    let valueDisplay = "";
                    
                    if (value instanceof Blob) {
                        const url = URL.createObjectURL(value);
                        const isAudio = value.type.includes('audio');
                        valueDisplay = `
                            <div class="audio-ctrl">
                                <span class="cell-blob">Blob [${value.type}] - ${(value.size/1024).toFixed(2)} KB</span>
                                ${isAudio ? `<audio controls src="${url}"></audio>` : ''}
                                <a href="${url}" download="${key}" class="download-link">ğŸ’¾ Táº£i vá» mÃ¡y</a>
                            </div>`;
                    } else if (typeof value === 'object' && value !== null) {
                        const jsonStr = JSON.stringify(value, null, 4);
                        valueDisplay = `<pre class="json-pretty">${jsonStr}</pre>`;
                    } else if (typeof value === 'string') {
                        try {
                            const parsed = JSON.parse(value);
                            if (typeof parsed === 'object' && parsed !== null) {
                                valueDisplay = `<pre class="json-pretty">${JSON.stringify(parsed, null, 4)}</pre>`;
                            } else {
                                valueDisplay = `<span>${value}</span>`;
                            }
                        } catch (e) {
                            valueDisplay = `<span>${value}</span>`;
                        }
                    } else {
                        valueDisplay = `<span>${value}</span>`;
                    }

                    tr.innerHTML = `
                        <td class="cell-index">${count}</td>
                        <td class="cell-key">${key}</td>
                        <td>${valueDisplay}</td>
                    `;
                    tbody.appendChild(tr);
                    cursor.continue();
                } else if (count === 0) {
                    tbody.innerHTML = "<tr><td colspan='3' style='text-align:center'>Trá»‘ng.</td></tr>";
                }
                db.close();
            };
        };
    }

    async function syncToCloud(dbName, storeName) {
        const url = scriptUrlInput.value;
        if (!url) return alert("Vui lÃ²ng nháº­p Google Script URL!");

        writeLog(`Báº¯t Ä‘áº§u Ä‘á»“ng bá»™ ${storeName} lÃªn Cloud...`);
        const req = indexedDB.open(dbName);
        req.onsuccess = (e) => {
            const db = e.target.result;
            const tx = db.transaction(storeName, "readonly");
            const store = tx.objectStore(storeName);
            
            store.openCursor().onsuccess = async (ev) => {
                const cursor = ev.target.result;
                if (cursor) {
                    const key = cursor.key;
                    let value = cursor.value;
                    
                    // Chá»‰ Ä‘á»“ng bá»™ JSON/String, khÃ´ng há»— trá»£ Blob trá»±c tiáº¿p qua json sync nÃ y
                    if (!(value instanceof Blob)) {
                        try {
                            await fetch(url, {
                                method: 'POST',
                                mode: 'no-cors', // Cáº§n thiáº¿t cho GAS náº¿u khÃ´ng cÃ³ CORS header
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({ key: String(key), value: value })
                            });
                            writeLog(`ÄÃ£ gá»­i Key: ${key}`);
                        } catch (err) { writeLog(`Lá»—i gá»­i Key ${key}: ${err.message}`); }
                    }
                    cursor.continue();
                } else {
                    writeLog(`HoÃ n táº¥t gá»­i dá»¯ liá»‡u ${storeName}.`);
                    db.close();
                }
            };
        };
    }

    async function syncFromCloud(dbName, storeName) {
        const url = scriptUrlInput.value;
        if (!url) return alert("Vui lÃ²ng nháº­p Google Script URL!");

        const keyToSync = prompt("Nháº­p KEY cáº§n Ä‘á»“ng bá»™ tá»« Cloud vá» (TÃªn file trÃªn Driver):");
        if (!keyToSync) return;

        writeLog(`Äang láº¥y dá»¯ liá»‡u cho Key: ${keyToSync} ...`);
        try {
            const response = await fetch(`${url}?key=${encodeURIComponent(keyToSync)}`);
            const cloudData = await response.json();
            
            if (cloudData === null) {
                writeLog(`KhÃ´ng tÃ¬m tháº¥y dá»¯ liá»‡u cho Key: ${keyToSync} trÃªn Cloud.`);
                return;
            }

            const req = indexedDB.open(dbName);
            req.onsuccess = (e) => {
                const db = e.target.result;
                const tx = db.transaction(storeName, "readwrite");
                const store = tx.objectStore(storeName);
                
                store.put(cloudData, keyToSync);
                tx.oncomplete = () => {
                    writeLog(`ÄÃ£ cáº­p nháº­t thÃ nh cÃ´ng Key: ${keyToSync} vÃ o ${storeName}`);
                    db.close();
                    deepScan();
                };
            };
        } catch (err) {
            writeLog(`Lá»—i khi láº¥y dá»¯ liá»‡u: ${err.message}`);
        }
    }

    function clearData(dbName, storeName, safeId) {
        if (!confirm(`Cáº¢NH BÃO: Báº¡n cÃ³ cháº¯c muá»‘n XÃ“A VÄ¨NH VIá»„N toÃ n bá»™ Database [${dbName}]?`)) return;
        
        const req = indexedDB.open(dbName);
        req.onsuccess = (e) => {
            const db = e.target.result;
            db.close(); 
            
            const delReq = indexedDB.deleteDatabase(dbName);
            delReq.onsuccess = () => {
                writeLog(`ÄÃ£ XÃ“A Database: ${dbName}`);
                deepScan(); 
            };
            delReq.onerror = (err) => writeLog("Lá»—i khi xÃ³a Database: " + err.target.error);
            delReq.onblocked = () => writeLog("XÃ³a bá»‹ cháº·n: Vui lÃ²ng Ä‘Ã³ng cÃ¡c tab khÃ¡c Ä‘ang dÃ¹ng DB nÃ y.");
        };
    }
</script>

</body>
</html>