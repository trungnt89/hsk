<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>PMP Master Pro - UI Update</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <script src="data1.js"></script>
    <script src="data2.js"></script>
    <script src="data3.js"></script>

    <style>
        :root { 
            --primary: #007AFF; --easy: #28CD41; --medium: #FF9500; --hard: #FF3B30;
            --bg: #F2F2F7; --card: #FFFFFF; --text-main: #1C1C1E; --text-sub: #8E8E93;
            --ios-blur: rgba(255, 255, 255, 0.96);
        }
        
        body, html { 
            margin: 0; padding: 0; height: 100%; width: 100vw; 
            font-family: -apple-system, 'Inter', sans-serif; 
            background-color: var(--bg); display: flex; flex-direction: column; 
            overflow: hidden; touch-action: pan-y;
        }

        /* --- 2. HEADER: CH·ªà 3 BUTTON TOP --- */
        .system-header { 
            background: var(--ios-blur); backdrop-filter: saturate(180%) blur(20px); 
            border-bottom: 0.5px solid rgba(0,0,0,0.1); flex-shrink: 0; z-index: 1000; 
            padding-top: env(safe-area-inset-top);
        }
        .nav-row { padding: 10px 16px; display: flex; justify-content: space-between; align-items: center; }
        .brand { font-size: 16px; font-weight: 900; color: var(--text-main); }
        
        .filter-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; padding: 0 12px 12px; }
        .tab-pill {
            border: none; padding: 10px 4px; border-radius: 10px; 
            font-size: 11px; font-weight: 700; background: rgba(0,0,0,0.08); 
            color: #3A3A3C; text-align: center; cursor: pointer;
        }
        .tab-pill.active { background: var(--text-main); color: white; }

        /* --- CONTENT --- */
        .content-viewport { flex-grow: 1; position: relative; overflow: hidden; }
        .main-card { 
            position: absolute; inset: 0; background: var(--card); 
            margin: 10px; border-radius: 20px; box-sizing: border-box; 
            overflow-y: auto; box-shadow: 0 8px 25px rgba(0,0,0,0.05);
            padding-bottom: 120px;
        }
        .question-body { padding: 16px; }

        /* M·ª©c ƒë·ªô kh√≥ ·ªü g√≥c ph·∫£i c√¢u h·ªèi */
        .diff-status-box {
            float: right; display: flex; gap: 4px; position: sticky; top: 0; background: white; padding: 4px; border-radius: 8px;
        }
        .q-diff-tag { font-size: 9px; font-weight: 800; padding: 4px 6px; border-radius: 4px; border: 1px solid #EEE; color: #CCC; }
        .q-diff-tag.active[data-type="Easy"] { background: var(--easy); color: white; border-color: var(--easy); }
        .q-diff-tag.active[data-type="Medium"] { background: var(--medium); color: white; border-color: var(--medium); }
        .q-diff-tag.active[data-type="Hard"] { background: var(--hard); color: white; border-color: var(--hard); }

        .q-text { font-size: 16px; font-weight: 600; line-height: 1.5; color: var(--text-main); margin: 30px 0 20px; }
        .option-item { 
            font-size: 14px; padding: 14px; background: #F2F2F7; border-radius: 14px; 
            margin-bottom: 10px; border: 2px solid transparent; 
        }
        .option-item.selected { border-color: var(--primary); background: #E5F1FF; }
        .option-item.is-correct { background: #EFFFF3 !important; border-color: var(--easy) !important; color: #1A8B31 !important; }

        .note-input { width: 100%; min-height: 60px; border-radius: 12px; border: 1px solid #E5E5EA; padding: 10px; font-size: 13px; background: #FAFAFA; resize: none; margin-top: 15px; }

        /* --- 10. BOTTOM NAV: 6 BUTTONS --- */
        .bottom-nav { 
            height: 80px; background: white; border-top: 0.5px solid rgba(0,0,0,0.1);
            display: grid; grid-template-columns: repeat(6, 1fr); gap: 4px;
            padding: 6px 8px env(safe-area-inset-bottom); position: fixed; bottom: 0; width: 100%; box-sizing: border-box;
        }
        .nav-btn {
            border: 1.5px solid #E5E5EA; background: white; border-radius: 8px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            color: #8E8E93; cursor: pointer; font-size: 9px; font-weight: 700; transition: 0.2s;
        }
        .nav-btn.active { border-color: var(--primary); color: var(--primary); background: #F0F7FF; }
        .nav-btn.selected-diff { border-width: 2px; }
        .nav-btn[onclick*="Easy"].active { border-color: var(--easy); color: var(--easy); }
        .nav-btn[onclick*="Medium"].active { border-color: var(--medium); color: var(--medium); }
        .nav-btn[onclick*="Hard"].active { border-color: var(--hard); color: var(--hard); }
        
        .nav-btn i { font-style: normal; font-size: 16px; margin-bottom: 2px; }
        .nav-btn .count-val { font-size: 10px; margin-top: 2px; }

        /* D·ªãch Overlay */
        #trans-panel {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 85%; background: #1C1C1E; color: white; padding: 20px; z-index: 3000;
            display: none; border-radius: 20px; box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }
    </style>
</head>
<body>

<div id="trans-panel">
    <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
        <span style="color:var(--easy); font-weight:800; font-size:12px;">D·ªäCH</span>
        <span onclick="this.parentElement.parentElement.style.display='none'" style="cursor:pointer;">√ó</span>
    </div>
    <div id="trans-content"></div>
</div>

<header class="system-header">
    <div class="nav-row">
        <div class="brand">PMP MASTER PRO</div>
        <select id="set-select" onchange="changeExamSet(this.value)" style="border:none; font-weight:800; color:var(--primary); background:transparent;">
            <option value="DATA_SET_1">ƒê·ªÄ 01</option>
            <option value="DATA_SET_2">ƒê·ªÄ 02</option>
        </select>
    </div>
    <div class="filter-grid">
        <button class="tab-pill" id="tab-todo" onclick="switchTab('todo')">M·ªöI</button>
        <button class="tab-pill" id="tab-done" onclick="switchTab('done')">ƒê√É H·ªåC</button>
        <button class="tab-pill" id="tab-notdone" onclick="switchTab('notdone')">CH∆ØA H·ªåC</button>
    </div>
</header>

<main class="content-viewport">
    <div id="book-page" class="main-card"></div>
</main>

<nav class="bottom-nav">
    <div class="nav-btn" onclick="triggerFlip('prev')"><i>‚èÆ</i>L√ôI</div>
    <div class="nav-btn" id="btn-ans" onclick="toggleInfo()"><i>üëÅ</i>ƒê√ÅP √ÅN</div>
    <div class="nav-btn" id="btn-Easy" onclick="setDiffAndFilter('Easy')">D·ªÑ<span class="count-val" id="cnt-Easy">(0)</span></div>
    <div class="nav-btn" id="btn-Medium" onclick="setDiffAndFilter('Medium')">V·ª™A<span class="count-val" id="cnt-Medium">(0)</span></div>
    <div class="nav-btn" id="btn-Hard" onclick="setDiffAndFilter('Hard')">KH√ì<span class="count-val" id="cnt-Hard">(0)</span></div>
    <div class="nav-btn" onclick="triggerFlip('next')"><i>‚è≠</i>TI·∫æP</div>
</nav>

<script>
let state = JSON.parse(localStorage.getItem('PMP_PRO_STATE')) || {
    set: 'DATA_SET_1', tab: 'todo', progress: {} 
};

let pmpData = []; let filteredData = []; let currentIndex = 0;

// --- D·ªäCH THU·∫¨T ---
document.addEventListener('selectionchange', () => {
    const text = window.getSelection().toString().trim();
    if (text.length > 2) {
        const panel = document.getElementById('trans-panel');
        document.getElementById('trans-content').innerText = "ƒêang d·ªãch...";
        panel.style.display = 'block';
        fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=en&tl=vi&dt=t&q=${encodeURIComponent(text)}`)
            .then(r => r.json()).then(d => { document.getElementById('trans-content').innerText = d[0].map(i=>i[0]).join(""); });
    }
});

// --- CORE ---
function save() { localStorage.setItem('PMP_PRO_STATE', JSON.stringify(state)); }

function changeExamSet(v) { state.set = v; pmpData = window[v] || []; currentIndex = 0; save(); update(); }

function switchTab(t) { state.tab = t; currentIndex = 0; save(); update(); }

function update() {
    // Top Tabs
    document.querySelectorAll('.tab-pill').forEach(b => b.classList.remove('active'));
    document.getElementById('tab-' + state.tab).classList.add('active');

    // Filter Logic
    filteredData = pmpData.filter(q => {
        const p = state.progress[q.id];
        if (state.tab === 'done') return p && p.ans;
        if (state.tab === 'notdone') return p && !p.ans;
        return true;
    });

    // C·∫≠p nh·∫≠t b·ªô ƒë·∫øm 10
    const counts = {Easy:0, Medium:0, Hard:0};
    pmpData.forEach(q => { if(state.progress[q.id]?.diff) counts[state.progress[q.id].diff]++; });
    document.getElementById('cnt-Easy').innerText = `(${counts.Easy})`;
    document.getElementById('cnt-Medium').innerText = `(${counts.Medium})`;
    document.getElementById('cnt-Hard').innerText = `(${counts.Hard})`;

    render();
}

function render() {
    const container = document.getElementById('book-page');
    const q = filteredData[currentIndex];
    if (!q) { container.innerHTML = "<center style='margin-top:50px'>H·∫øt c√¢u h·ªèi</center>"; return; }

    const p = state.progress[q.id] || {};
    
    // Highlight n√∫t ƒë·ªô kh√≥ ·ªü thanh d∆∞·ªõi (Y√™u c·∫ßu 10)
    document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
    if(p.diff) document.getElementById('btn-' + p.diff).classList.add('active');

    container.innerHTML = `
        <div class="question-body">
            <div class="diff-status-box">
                <div class="q-diff-tag ${p.diff==='Easy'?'active':''}" data-type="Easy">EASY</div>
                <div class="q-diff-tag ${p.diff==='Medium'?'active':''}" data-type="Medium">MED</div>
                <div class="q-diff-tag ${p.diff==='Hard'?'active':''}" data-type="Hard">HARD</div>
            </div>
            <div style="font-size:11px; font-weight:800; color:var(--primary)">C√ÇU ${currentIndex+1}/${filteredData.length}</div>
            <div class="q-text">${q.question}</div>
            <div class="options">
                ${Object.entries(q.options).map(([k,v]) => `
                    <div class="option-item ${p.ans===k?'selected':''}" onclick="selectAns('${q.id}','${k}')"><b>${k}.</b> ${v}</div>
                `).join('')}
            </div>
            <div id="exp" style="display:none; margin-top:15px; padding:12px; background:#F2F2F7; border-radius:10px; font-size:13px;">${q.explanation}</div>
            <textarea class="note-input" placeholder="Ghi ch√∫..." oninput="saveNote('${q.id}',this.value)">${p.note||''}</textarea>
        </div>
    `;
}

function selectAns(qid, k) {
    if(!state.progress[qid]) state.progress[qid] = {};
    state.progress[qid].ans = (state.progress[qid].ans === k) ? null : k;
    save(); render();
}

function setDiffAndFilter(level) {
    const q = filteredData[currentIndex];
    if(!q) return;
    if(!state.progress[q.id]) state.progress[q.id] = {};
    // Toggle ƒë·ªô kh√≥
    state.progress[q.id].diff = (state.progress[q.id].diff === level) ? null : level;
    save(); update();
}

function saveNote(qid, txt) {
    if(!state.progress[qid]) state.progress[qid] = {};
    state.progress[qid].note = txt; save();
}

function toggleInfo() {
    const q = filteredData[currentIndex];
    const el = document.getElementById('exp');
    const btn = document.getElementById('btn-ans');
    if(el.style.display === 'none') {
        el.style.display = 'block';
        btn.classList.add('active');
    } else {
        el.style.display = 'none';
        btn.classList.remove('active');
    }
}

function triggerFlip(dir) {
    if(dir==='next' && currentIndex < filteredData.length-1) currentIndex++;
    if(dir==='prev' && currentIndex > 0) currentIndex--;
    render();
}

window.onload = () => { changeExamSet(state.set); };
</script>
</body>
</html>