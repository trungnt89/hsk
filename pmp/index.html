<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PMP Master - Ultimate Toggle</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;800&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root { 
            --primary: #2563eb; --accent: #fbbf24; --danger: #ef4444; 
            --bg: #f8fafc; --card: #ffffff; --success: #10b981; 
            --text-main: #1e293b; --text-sub: #64748b;
        }
        
        body, html { 
            margin: 0; padding: 0; height: 100%; width: 100vw; 
            font-family: 'Inter', sans-serif; background: var(--bg); 
            display: flex; flex-direction: column; overflow: hidden; 
            -webkit-tap-highlight-color: transparent;
        }

        /* Loading Overlay */
        #loading {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.9); display: none;
            flex-direction: column; align-items: center; justify-content: center;
            z-index: 1000; font-weight: 800; color: var(--primary);
        }

        /* Top Section */
        .top-section { background: #fff; box-shadow: 0 1px 3px rgba(0,0,0,0.05); flex-shrink: 0; z-index: 100; padding-bottom: 5px; }
        header { padding: 12px 15px; display: flex; justify-content: space-between; align-items: center; }
        header h3 { margin: 0; color: var(--primary); font-family: 'Montserrat'; font-size: 1rem; }
        #set-label { font-weight: 800; color: var(--primary); font-size: 10px; background: #eff6ff; padding: 4px 8px; border-radius: 6px; }

        .progress-container { padding: 0 15px 10px; }
        .progress-info { display: flex; justify-content: space-between; font-size: 9px; font-weight: 800; color: var(--text-sub); margin-bottom: 4px; }
        .progress-bar-bg { width: 100%; height: 6px; background: #f1f5f9; border-radius: 10px; overflow: hidden; }
        #progress-fill { width: 0%; height: 100%; background: linear-gradient(90deg, var(--primary), var(--success)); transition: width 0.5s ease; }

        .tab-box { display: flex; padding: 0 12px 10px; gap: 8px; }
        .tab-btn { 
            flex: 1; border: none; padding: 10px; border-radius: 12px; 
            font-size: 10px; font-weight: 800; color: #94a3b8; background: #f1f5f9; 
            cursor: pointer; transition: 0.1s; font-family: 'Montserrat';
        }
        .tab-btn.active { background: var(--primary); color: white; }
        .tab-btn.active.done-mode { background: var(--success); }

        .settings-panel { padding: 0 12px 10px; }
        select { width: 100%; border: 1.5px solid #f1f5f9; padding: 10px; border-radius: 10px; font-weight: 700; font-size: 12px; outline: none; background: #fff; color: var(--text-main); }

        /* Main Display area */
        .main-display { flex-grow: 1; display: flex; flex-direction: column; padding: 12px; overflow-y: auto; padding-bottom: 120px; }
        
        .q-card { 
            background: var(--card); border-radius: 16px; padding: 20px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.03); border: 2px solid transparent;
            min-height: 250px; animation: slideIn 0.2s ease-out;
        }
        @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .q-id-tag { font-size: 10px; font-weight: 800; color: var(--primary); margin-bottom: 10px; display: block; opacity: 0.6; }
        .q-text { font-size: 15px; font-weight: 600; line-height: 1.5; color: var(--text-main); margin-bottom: 20px; }
        
        .options-list { display: grid; gap: 8px; }
        .option-item { font-size: 13px; padding: 12px; background: #f8fafc; border-radius: 10px; border: 1px solid #f1f5f9; color: var(--text-main); }
        .option-item.correct { background: #ecfdf5; border-color: var(--success); color: var(--success); font-weight: 700; }

        .info-panel { border-top: 1.5px dashed #f1f5f9; padding-top: 15px; margin-top: 20px; }
        .explanation { font-size: 12px; color: var(--text-sub); line-height: 1.5; }

        /* Controls Bar */
        .controls-bar { 
            height: 95px; background: #fff; display: flex; align-items: center; 
            box-shadow: 0 -5px 20px rgba(0,0,0,0.05); border-radius: 24px 24px 0 0; 
            padding: 0 8px; flex-shrink: 0; position: fixed; bottom: 0; width: 100%;
        }
        .ctrl-group { flex: 1; display: flex; justify-content: space-evenly; align-items: center; }
        
        .btn-nav { 
            background: transparent; border: none; color: #94a3b8; width: 55px; height: 55px; 
            border-radius: 16px; display: flex; flex-direction: column; align-items: center; 
            justify-content: center; cursor: pointer; transition: 0.15s; 
        }
        .btn-nav i { font-style: normal; font-size: 18px; margin-bottom: 2px; }
        .btn-nav small { font-size: 8px; font-weight: 800; text-transform: uppercase; }
        .btn-nav.active-blue { color: var(--primary); background: #eff6ff; }
        .btn-nav.status-active { color: var(--success); }
        .btn-nav:disabled { opacity: 0.2; }

        .btn-master { 
            width: 70px; height: 70px; background: var(--accent); 
            border: 6px solid var(--bg); border-radius: 50%; 
            font-size: 26px; color: white; cursor: pointer; 
            box-shadow: 0 8px 15px rgba(251, 191, 36, 0.3); 
            display: flex; align-items: center; justify-content: center; 
            position: absolute; top: -35px; left: 50%; transform: translateX(-50%); 
            transition: 0.2s; z-index: 200;
        }
        .btn-master.is-ok { background: var(--success); box-shadow: 0 8px 15px rgba(16, 185, 129, 0.3); }
    </style>
</head>
<body>

<div id="loading"><span>ƒêANG T·∫¢I D·ªÆ LI·ªÜU...</span></div>

<div class="top-section">
    <header><h3>PMP MASTER</h3><div id="set-label">SET 01</div></header>
    
    <div class="progress-container">
        <div class="progress-info">
            <span id="progress-text">TI·∫æN ƒê·ªò: 0%</span>
            <span id="count-text">0/0</span>
        </div>
        <div class="progress-bar-bg"><div id="progress-fill"></div></div>
    </div>

    <div class="tab-box">
        <button class="tab-btn active" id="tab-todo" onclick="switchTab('todo')">C·∫¶N H·ªåC (0)</button>
        <button class="tab-btn" id="tab-done" onclick="switchTab('done')">ƒê√É XONG (0)</button>
    </div>

    <div class="settings-panel">
        <select id="set-select" onchange="loadExamData(this.value)">
            <option value="data1.json">ƒê·ªÅ thi s·ªë 01</option>
            <option value="data2.json">ƒê·ªÅ thi s·ªë 02</option>
            <option value="data3.json">ƒê·ªÅ thi s·ªë 03</option>
        </select>
    </div>
</div>

<div class="main-display" id="display-area"></div>

<div class="controls-bar">
    <div class="ctrl-group">
        <button class="btn-nav" id="prev-btn" onclick="prevQuestion()"><i>‚èÆ</i><small>Tr∆∞·ªõc</small></button>
        <button class="btn-nav" id="info-btn" onclick="toggleInfo()"><i>üëÅÔ∏è</i><small id="info-txt">Hi·ªán</small></button>
    </div>
    
    <button class="btn-master" id="master-btn" onclick="toggleMasterCurrent()">‚úîÔ∏è</button>
    
    <div class="ctrl-group">
        <button class="btn-nav" id="next-btn" onclick="nextQuestion()"><i>‚è≠</i><small>Sau</small></button>
        <button class="btn-nav" id="status-btn" onclick="toggleMasterCurrent()">
            <i id="status-icon">‚ö™</i><small id="status-txt">Tr·∫°ng th√°i</small>
        </button>
    </div>
</div>

<script>
// --- GLOBAL STATE ---
let pmpData = []; 
let currentIndexInSet = 0;
let showInfo = false;
let currentTab = 'todo';
let filteredQuestions = [];
const MASTER_KEY = "PMP_ULTIMATE_TOGGLE_DB";

// --- CORE FUNCTIONS ---

async function loadExamData(fileName) {
    const loading = document.getElementById('loading');
    loading.style.display = 'flex';

    try {
        const response = await fetch(fileName + '?v=' + new Date().getTime()); // Tr√°nh cache
        if (!response.ok) throw new Error("Kh√¥ng th·ªÉ t·∫£i t·ªáp " + fileName);
        
        pmpData = await response.json();
        
        loading.style.display = 'none';
        document.getElementById('set-label').innerText = document.getElementById('set-select').selectedOptions[0].text.toUpperCase();
        
        currentIndexInSet = 0;
        showInfo = false;
        const btn = document.getElementById('info-btn');
        btn.classList.remove('active-blue');
        document.getElementById('info-txt').innerText = "Hi·ªán";
        
        updateFilteredData();
    } catch (error) {
        loading.style.display = 'none';
        alert("L·ªói: " + error.message + "\nL∆∞u √Ω: B·∫°n c·∫ßn ch·∫°y b·∫±ng Live Server ho·∫∑c Hosting.");
    }
}

function haptic() { if (navigator.vibrate) navigator.vibrate(15); }

function switchTab(type) {
    currentTab = type;
    currentIndexInSet = 0;
    document.getElementById('tab-todo').className = `tab-btn ${type === 'todo' ? 'active' : ''}`;
    document.getElementById('tab-done').className = `tab-btn ${type === 'done' ? 'active done-mode' : ''}`;
    updateFilteredData();
}

function updateFilteredData() {
    const mastered = JSON.parse(localStorage.getItem(MASTER_KEY) || "[]");
    
    filteredQuestions = pmpData.filter(q => {
        const isM = mastered.includes(q.id);
        return currentTab === 'todo' ? !isM : isM;
    });

    const todoTotal = pmpData.filter(q => !mastered.includes(q.id)).length;
    const doneTotal = pmpData.filter(q => mastered.includes(q.id)).length;
    const percent = Math.round((doneTotal / pmpData.length) * 100) || 0;

    document.getElementById('tab-todo').innerText = `C·∫¶N H·ªåC (${todoTotal})`;
    document.getElementById('tab-done').innerText = `ƒê√É XONG (${doneTotal})`;
    document.getElementById('progress-fill').style.width = percent + '%';
    document.getElementById('progress-text').innerText = `TI·∫æN ƒê·ªò: ${percent}%`;
    document.getElementById('count-text').innerText = `${doneTotal}/${pmpData.length}`;

    renderQuestion();
}

function renderQuestion() {
    const area = document.getElementById('display-area');
    const q = filteredQuestions[currentIndexInSet];
    const masterBtn = document.getElementById('master-btn');
    const statusBtn = document.getElementById('status-btn');

    if (!q) {
        area.innerHTML = `<div class="q-card" style="display:flex; flex-direction:column; align-items:center; justify-content:center; color:#94a3b8; text-align:center;">
            <span style="font-size:40px; margin-bottom:10px;">üéâ</span>
            <span>M·ª•c n√†y hi·ªán ƒëang tr·ªëng!<br>H√£y chuy·ªÉn tab ho·∫∑c ch·ªçn ƒë·ªÅ kh√°c.</span>
        </div>`;
        masterBtn.style.display = "none";
        statusBtn.style.opacity = "0.2";
        updateNavButtons();
        return;
    }

    masterBtn.style.display = "flex";
    statusBtn.style.opacity = "1";
    
    const mastered = JSON.parse(localStorage.getItem(MASTER_KEY) || "[]");
    const isM = mastered.includes(q.id);
    
    masterBtn.innerHTML = isM ? '‚úÖ' : '‚úîÔ∏è';
    masterBtn.className = isM ? 'btn-master is-ok' : 'btn-master';

    document.getElementById('status-icon').innerText = isM ? 'üü¢' : '‚ö™';
    document.getElementById('status-txt').innerText = isM ? 'ƒê√£ OK' : 'Ch∆∞a OK';
    statusBtn.className = isM ? 'btn-nav status-active' : 'btn-nav';

    let opts = '';
    for (const [key, val] of Object.entries(q.options)) {
        const isCorrect = (key === q.answer && showInfo);
        opts += `<div class="option-item ${isCorrect ? 'correct' : ''}"><strong>${key}.</strong> ${val}</div>`;
    }

    area.innerHTML = `
        <div class="q-card">
            <span class="q-id-tag">ID: #${q.id}</span>
            <div class="q-text">${q.question}</div>
            <div class="options-list">${opts}</div>
            ${showInfo ? `<div class="info-panel"><div class="explanation"><strong>Gi·∫£i th√≠ch:</strong> ${q.explanation}</div></div>` : ''}
        </div>
    `;
    updateNavButtons();
}

function toggleMasterCurrent() {
    const q = filteredQuestions[currentIndexInSet];
    if (!q) return;
    haptic();

    let mastered = JSON.parse(localStorage.getItem(MASTER_KEY) || "[]");
    if (mastered.includes(q.id)) {
        mastered = mastered.filter(i => i !== q.id);
    } else {
        mastered.push(q.id);
    }
    localStorage.setItem(MASTER_KEY, JSON.stringify(mastered));

    // Logic: N·∫øu chuy·ªÉn xong c√¢u cu·ªëi, l√πi l·∫°i 1 index
    if (currentIndexInSet >= filteredQuestions.length - 1 && currentIndexInSet > 0) {
        currentIndexInSet--;
    }
    updateFilteredData();
}

function toggleInfo() {
    showInfo = !showInfo;
    const btn = document.getElementById('info-btn');
    btn.classList.toggle('active-blue', showInfo);
    document.getElementById('info-txt').innerText = showInfo ? "·∫®n" : "Hi·ªán";
    renderQuestion();
}

function nextQuestion() { if (currentIndexInSet < filteredQuestions.length - 1) { currentIndexInSet++; haptic(); renderQuestion(); } }
function prevQuestion() { if (currentIndexInSet > 0) { currentIndexInSet--; haptic(); renderQuestion(); } }

function updateNavButtons() {
    document.getElementById('prev-btn').disabled = (currentIndexInSet === 0 || filteredQuestions.length === 0);
    document.getElementById('next-btn').disabled = (currentIndexInSet >= filteredQuestions.length - 1 || filteredQuestions.length === 0);
}

// Kh·ªüi ch·∫°y
window.onload = () => loadExamData(document.getElementById('set-select').value);

</script>
</body>
</html>