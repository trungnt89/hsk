<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>TTS Auto-Key Tester</title>
    <style>
        :root { --primary: #0078d4; }
        body { font-family: 'Segoe UI', sans-serif; background: #faf9f8; display: flex; justify-content: center; padding: 40px; }
        .card { background: white; padding: 25px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); width: 450px; }
        .field { margin-bottom: 12px; }
        label { display: block; font-size: 12px; font-weight: bold; margin-bottom: 4px; }
        select, textarea { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        button { width: 100%; padding: 12px; background: var(--primary); color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; margin-top: 10px; }
        #status { margin-top: 15px; font-size: 13px; color: #666; text-align: center; min-height: 18px; }
    </style>
</head>
<body>

<div class="card">
    <h2 style="margin-top:0; color: var(--primary)">Azure TTS Engine</h2>
    
    <div class="field">
        <label>Nội dung</label>
        <textarea id="text" rows="3">Xin chào, filename sẽ tự động được tạo.</textarea>
    </div>

    <div class="field">
        <label>Ngôn ngữ & Giọng đọc</label>
        <select id="voiceConfig" onchange="/* Optional: update internal state */">
            <optgroup label="Tiếng Việt">
                <option value="vi-VN|vi-VN-HoaiMyNeural">Hoài My (Nữ)</option>
                <option value="vi-VN|vi-VN-NamMinhNeural">Nam Minh (Nam)</option>
            </optgroup>
            <optgroup label="Tiếng Trung">
                <option value="zh-CN|zh-CN-XiaoxiaoNeural">Xiaoxiao (Nữ)</option>
                <option value="zh-CN|zh-CN-YunxiNeural">Yunxi (Nam)</option>
            </optgroup>
        </select>
    </div>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
        <div class="field">
            <label>Tốc độ</label>
            <select id="rate">
                <option value="0.8">Chậm</option>
                <option value="1.0" selected>Bình thường</option>
                <option value="1.2">Nhanh</option>
            </select>
        </div>
        <div class="field">
            <label>Định dạng</label>
            <select id="format">
                <option value="audio-16khz-32kbitrate-mono-mp3">MP3 Low</option>
                <option value="audio-16khz-128kbitrate-mono-mp3">MP3 High</option>
            </select>
        </div>
    </div>

    <button id="playBtn" onclick="runTTS()">PHÁT ÂM THANH</button>
    <div id="status"></div>
</div>

<script src="../com/TTSClient.js"></script>
<script>
    async function runTTS() {
        const btn = document.getElementById('playBtn');
        const status = document.getElementById('status');
        
        // Tách Lang và Voice từ value của dropdown
        const [lang, voice] = document.getElementById('voiceConfig').value.split('|');

        const params = {
            text: document.getElementById('text').value.trim(),
            lang: lang,
            voice: voice,
            rate: document.getElementById('rate').value,
            format: document.getElementById('format').value,
            // filename: "" // Để trống để client.js tự generate
        };

        try {
            btn.disabled = true;
            await TTSClient.play(params, (msg) => status.innerText = msg);
        } catch (err) {
            status.innerText = "Lỗi hệ thống";
        } finally {
            btn.disabled = false;
        }
    }
</script>
</body>
</html>