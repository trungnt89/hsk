<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Safari Optimized Video Call</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        body { font-family: -apple-system, system-ui, sans-serif; display: flex; flex-direction: column; align-items: center; background: #f0f2f5; margin: 0; padding: 15px; }
        .container { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); width: 100%; max-width: 500px; text-align: center; }
        .video-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px; width: 100%; max-width: 800px; }
        video { width: 100%; border-radius: 12px; background: #000; transform: scaleX(-1); border: 1px solid #ddd; height: 180px; object-fit: cover; }
        .controls { display: flex; flex-direction: column; gap: 10px; margin-top: 15px; }
        input { padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; -webkit-appearance: none; }
        .btn-group { display: flex; gap: 10px; }
        button { padding: 12px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; flex: 1; transition: opacity 0.2s; }
        .btn-primary { background: #007aff; color: white; }
        .btn-success { background: #34c759; color: white; }
        .btn-danger { background: #ff3b30; color: white; display: none; }
        #qrcode { display: flex; justify-content: center; margin: 15px 0; }
        .status-id { font-weight: bold; color: #ff3b30; word-break: break-all; }
    </style>
</head>
<body>

<div class="container">
    <h3>Video Call (Safari Ready)</h3>
    <div class="controls">
        <input type="text" id="my-id-input" placeholder="Tạo ID ngắn (VD: 8888)">
        <button class="btn-primary" id="set-id-btn">Thiết lập ID</button>
        <p style="font-size: 14px;">ID của bạn: <span id="peer-id-display" class="status-id">Đang kết nối...</span></p>
    </div>

    <div id="qrcode"></div>

    <hr style="width: 100%; border: 0.5px solid #eee;">

    <div class="controls">
        <input type="text" id="remote-id" placeholder="ID người nhận">
        <div class="btn-group">
            <button class="btn-success" id="call-btn">Gọi Video</button>
            <button class="btn-danger" id="end-btn">Kết thúc</button>
        </div>
    </div>
</div>

<div class="video-grid">
    <div><p align="center">Bạn</p><video id="local-video" autoplay playsinline muted></video></div>
    <div><p align="center">Đối phương</p><video id="remote-video" autoplay playsinline></video></div>
</div>

<script src="app.js"></script>
</body>
</html>