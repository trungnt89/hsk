<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>PMP Master iOS Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <script src="data1.js"></script>
    <script src="data2.js"></script>
    <script src="data3.js"></script>

    <style>
        :root { 
            --primary: #007AFF; --easy: #34C759; --medium: #FF9500; --hard: #FF3B30;
            --bg: #F2F2F7; --card: #FFFFFF; --text-main: #1C1C1E; --text-sub: #8E8E93;
            --ios-blur: rgba(255, 255, 255, 0.9);
        }
        
        body, html { 
            margin: 0; padding: 0; height: 100%; width: 100vw; 
            font-family: -apple-system, 'Inter', sans-serif; 
            background: var(--bg); display: flex; flex-direction: column; 
            overflow: hidden; -webkit-tap-highlight-color: transparent; 
        }

        /* KHU V·ª∞C C·ªê ƒê·ªäNH TR√äN C√ôNG */
        .top-section { 
            background: var(--ios-blur); 
            backdrop-filter: saturate(180%) blur(20px); 
            border-bottom: 0.5px solid rgba(0,0,0,0.1); 
            flex-shrink: 0; z-index: 1000; 
            padding-top: env(safe-area-inset-top);
        }
        
        header { padding: 12px 20px 8px; display: flex; justify-content: space-between; align-items: center; }
        header h3 { margin: 0; font-size: 19px; font-weight: 800; letter-spacing: -0.5px; }
        #set-label { font-size: 11px; font-weight: 700; color: var(--primary); background: #E5F1FF; padding: 4px 10px; border-radius: 20px; }

        /* Selector tr·∫°ng th√°i c·ªë ƒë·ªãnh */
        .sticky-controls {
            display: flex; justify-content: space-between; align-items: center;
            padding: 8px 16px 12px; border-top: 0.5px solid rgba(0,0,0,0.05);
        }
        .q-id-badge { font-size: 13px; font-weight: 800; color: var(--text-sub); }
        
        .level-selector { display: flex; gap: 6px; }
        .btn-level { 
            border: none; padding: 8px 14px; border-radius: 10px; 
            font-size: 11px; font-weight: 800; cursor: pointer; background: #E3E3E6; color: #8E8E93;
            transition: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .btn-level.active-hard { background: var(--hard); color: white; box-shadow: 0 4px 10px rgba(255,59,48,0.3); }
        .btn-level.active-medium { background: var(--medium); color: white; box-shadow: 0 4px 10px rgba(255,149,0,0.3); }
        .btn-level.active-easy { background: var(--easy); color: white; box-shadow: 0 4px 10px rgba(52,199,89,0.3); }

        .tab-box { display: grid; grid-template-columns: repeat(4, 1fr); padding: 4px; gap: 2px; background: #E3E3E6; margin: 0 16px 10px; border-radius: 10px; }
        .tab-btn { border: none; padding: 7px 2px; border-radius: 8px; font-size: 10px; font-weight: 700; color: #3A3A3C; background: transparent; }
        .tab-btn.active { background: white; box-shadow: 0 3px 8px rgba(0,0,0,0.1); color: var(--text-main); }

        .settings-panel { padding: 0 16px 12px; }
        select { width: 100%; border: none; padding: 10px; border-radius: 10px; font-size: 14px; font-weight: 600; background: rgba(0,0,0,0.05); outline: none; -webkit-appearance: none; }

        /* KHU V·ª∞C CU·ªòN N·ªòI DUNG */
        .main-display { 
            flex-grow: 1; overflow-y: auto; padding: 16px; 
            padding-bottom: 140px; /* Ch·ª´a kho·∫£ng tr·ªëng cho bottom bar */
            -webkit-overflow-scrolling: touch; 
        }
        .q-card { background: var(--card); border-radius: 24px; padding: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.04); margin-bottom: 20px; }
        .q-text { font-size: 18px; font-weight: 700; line-height: 1.45; color: var(--text-main); margin-bottom: 24px; }
        
        .options-list { display: flex; flex-direction: column; gap: 12px; }
        .option-item { font-size: 16px; padding: 16px; background: #F9F9FB; border-radius: 16px; border: 1.5px solid transparent; transition: 0.2s; font-weight: 500; line-height: 1.4; }
        .option-item.selected { border-color: var(--primary); background: #F0F7FF; color: var(--primary); }
        .option-item.is-correct { background: #E8F5E9 !important; border-color: var(--easy) !important; color: #2E7D32 !important; font-weight: 700; }
        .option-item.is-wrong { background: #FFEBEE !important; border-color: var(--hard) !important; color: #C62828 !important; }

        #confirm-btn { width: 100%; margin-top: 24px; padding: 18px; border-radius: 16px; border: none; background: var(--primary); color: white; font-size: 16px; font-weight: 800; display: none; box-shadow: 0 8px 16px rgba(0,122,255,0.2); }
        .explanation-box { margin-top: 24px; padding: 18px; background: #F2F2F7; border-radius: 16px; border-left: 5px solid var(--primary); font-size: 15px; line-height: 1.6; color: #3A3A3C; }

        /* KHU V·ª∞C C·ªê ƒê·ªäNH D∆Ø·ªöI C√ôNG */
        .iphone-bar { 
            height: 90px; background: var(--ios-blur); backdrop-filter: saturate(180%) blur(20px);
            border-top: 0.5px solid rgba(0,0,0,0.1);
            display: flex; align-items: flex-start; justify-content: space-around;
            position: fixed; bottom: 0; width: 100%; z-index: 1000; 
            padding: 10px 10px calc(10px + env(safe-area-inset-bottom)); box-sizing: border-box;
        }
        .tab-item { flex: 1; border: none; background: transparent; display: flex; flex-direction: column; align-items: center; color: #8E8E93; cursor: pointer; transition: 0.2s; }
        .tab-item i { font-style: normal; font-size: 26px; margin-bottom: 4px; }
        .tab-item small { font-size: 10px; font-weight: 700; text-transform: uppercase; }
        .tab-item.active-nav { color: var(--primary); }
        .tab-item:disabled { opacity: 0.2; }
    </style>
</head>
<body>

<div class="top-section">
    <header>
        <h3>PMP Master</h3>
        <div id="set-label">ƒêang t·∫£i...</div>
    </header>

    <div class="tab-box">
        <button class="tab-btn active" data-type="todo" onclick="switchTab('todo')">M·ªöI</button>
        <button class="tab-btn" data-type="Easy" onclick="switchTab('Easy')">D·ªÑ</button>
        <button class="tab-btn" data-type="Medium" onclick="switchTab('Medium')">V·ª™A</button>
        <button class="tab-btn" data-type="Hard" onclick="switchTab('Hard')">KH√ì</button>
    </div>

    <div class="settings-panel">
        <select id="set-select" onchange="changeExamSet(this.value)">
            <option value="DATA_SET_1">ƒê·ªÅ thi s·ªë 01</option>
            <option value="DATA_SET_2">ƒê·ªÅ thi s·ªë 02</option>
            <option value="DATA_SET_3">ƒê·ªÅ thi s·ªë 03</option>
        </select>
    </div>

    <div class="sticky-controls">
        <div class="q-id-badge" id="q-number-display">C√ÇU 0/0</div>
        <div class="level-selector" id="fixed-level-selector">
            </div>
    </div>
</div>

<div class="main-display" id="display-area">
    </div>

<div class="iphone-bar">
    <button class="tab-item" id="prev-btn" onclick="prevQuestion()"><i>‚Äπ</i><small>Tr∆∞·ªõc</small></button>
    <button class="tab-item" id="info-btn" onclick="toggleInfo()">
        <i id="eye-icon">‚óé</i><small id="info-txt">ƒê√°p √°n</small>
    </button>
    <button class="tab-item" id="next-btn" onclick="nextQuestion()"><i>‚Ä∫</i><small>Ti·∫øp theo</small></button>
</div>

<script>
let pmpData = []; 
let filteredQuestions = [];
let currentIndexInSet = 0;
let currentTab = 'todo';
let selectedOption = null;
let isConfirmed = false;
let currentSetName = ""; 
const STORAGE_PREFIX = "PMP_V8_";

function changeExamSet(setVarName) {
    let data = window[setVarName] || (typeof eval !== 'undefined' ? eval(setVarName) : null);
    if (data && Array.isArray(data)) {
        pmpData = data;
        currentSetName = setVarName;
        document.getElementById('set-label').innerText = setVarName.replace('DATA_SET_', 'B·ªò ƒê·ªÄ ');
        currentIndexInSet = 0;
        updateFilteredData();
    } else {
        setTimeout(() => changeExamSet(setVarName), 500);
    }
}

function updateFilteredData() {
    const stored = JSON.parse(localStorage.getItem(STORAGE_PREFIX + currentSetName) || "{}");
    const counts = { todo: 0, Easy: 0, Medium: 0, Hard: 0 };
    
    pmpData.forEach(q => {
        const level = stored[q.id];
        if (!level) counts.todo++; else counts[level]++;
    });

    document.querySelectorAll('.tab-btn').forEach(btn => {
        const type = btn.getAttribute('data-type');
        btn.innerText = `${type==='todo'?'M·ªöI':type.toUpperCase()} (${counts[type]})`;
        btn.classList.toggle('active', type === currentTab);
    });

    filteredQuestions = pmpData.filter(q => {
        const level = stored[q.id];
        return currentTab === 'todo' ? !level : level === currentTab;
    });

    renderQuestion();
}

function renderQuestion() {
    const area = document.getElementById('display-area');
    const q = filteredQuestions[currentIndexInSet];
    
    // 1. C·∫≠p nh·∫≠t s·ªë th·ª© t·ª± v√† n√∫t ƒëi·ªÅu h∆∞·ªõng
    document.getElementById('q-number-display').innerText = q ? `C√ÇU ${currentIndexInSet + 1}/${filteredQuestions.length}` : "0/0";
    document.getElementById('prev-btn').disabled = (currentIndexInSet === 0);
    document.getElementById('next-btn').disabled = (currentIndexInSet >= filteredQuestions.length - 1);

    // 2. Render b·ªô n√∫t Level c·ªë ƒë·ªãnh ·ªü Header
    renderFixedLevelSelector(q);
    resetInfoBtn();

    if (!q) {
        area.innerHTML = `<div style="text-align:center; padding:80px 20px; color:#8E8E93; font-weight:600;">üéâ M·ª•c n√†y ƒë√£ ho√†n th√†nh!</div>`;
        return;
    }
    
    selectedOption = null;
    isConfirmed = false;

    let opts = '';
    for (const [key, val] of Object.entries(q.options)) {
        opts += `<div class="option-item" id="opt-${key}" onclick="selectOption('${key}')"><strong>${key}.</strong> ${val}</div>`;
    }

    area.innerHTML = `
        <div class="q-card">
            <div class="q-text">${q.question}</div>
            <div class="options-list">${opts}</div>
            <button id="confirm-btn" onclick="confirmAnswer()">X√ÅC NH·∫¨N ƒê√ÅP √ÅN</button>
            <div id="explanation-area"></div>
        </div>`;
    area.scrollTo(0,0);
}

// H√†m render n√∫t Level l√™n khu v·ª±c Sticky Header
function renderFixedLevelSelector(q) {
    const container = document.getElementById('fixed-level-selector');
    if (!q) { container.innerHTML = ""; return; }

    const stored = JSON.parse(localStorage.getItem(STORAGE_PREFIX + currentSetName) || "{}");
    const level = stored[q.id];

    container.innerHTML = `
        <button class="btn-level ${level==='Hard'?'active-hard':''}" onclick="updateLevel(this, '${q.id}', 'Hard')">KH√ì</button>
        <button class="btn-level ${level==='Medium'?'active-medium':''}" onclick="updateLevel(this, '${q.id}', 'Medium')">V·ª™A</button>
        <button class="btn-level ${level==='Easy'?'active-easy':''}" onclick="updateLevel(this, '${q.id}', 'Easy')">D·ªÑ</button>
    `;
}

function updateLevel(btn, qId, level) {
    const key = STORAGE_PREFIX + currentSetName;
    const stored = JSON.parse(localStorage.getItem(key) || "{}");
    
    if (stored[qId] === level) delete stored[qId];
    else stored[qId] = level;
    
    localStorage.setItem(key, JSON.stringify(stored));

    // C·∫≠p nh·∫≠t UI n√∫t b·∫•m ngay l·∫≠p t·ª©c
    const parent = btn.parentElement;
    parent.querySelectorAll('.btn-level').forEach(b => {
        b.classList.remove('active-hard', 'active-medium', 'active-easy');
    });
    if (stored[qId]) btn.classList.add('active-' + level.toLowerCase());

    // C·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng tr√™n c√°c tab l·ªçc
    updateTabCountsOnly();
}

function updateTabCountsOnly() {
    const stored = JSON.parse(localStorage.getItem(STORAGE_PREFIX + currentSetName) || "{}");
    const counts = { todo: 0, Easy: 0, Medium: 0, Hard: 0 };
    pmpData.forEach(q => {
        const level = stored[q.id];
        if (!level) counts.todo++; else counts[level]++;
    });
    document.querySelectorAll('.tab-btn').forEach(btn => {
        const type = btn.getAttribute('data-type');
        btn.innerText = `${type==='todo'?'M·ªöI':type.toUpperCase()} (${counts[type]})`;
    });
}

function selectOption(key) {
    if (isConfirmed) return;
    selectedOption = key;
    document.querySelectorAll('.option-item').forEach(el => el.classList.remove('selected'));
    document.getElementById(`opt-${key}`).classList.add('selected');
    document.getElementById('confirm-btn').style.display = 'block';
}

function confirmAnswer() {
    if (!selectedOption || isConfirmed) return;
    showAnswerUI();
}

function showAnswerUI() {
    isConfirmed = true;
    const q = filteredQuestions[currentIndexInSet];
    document.getElementById('confirm-btn').style.display = 'none';
    
    const infoBtn = document.getElementById('info-btn');
    infoBtn.classList.add('active-nav');
    document.getElementById('eye-icon').innerText = "‚óâ";
    
    document.querySelectorAll('.option-item').forEach(el => el.classList.remove('is-correct', 'is-wrong'));

    if (selectedOption === q.answer) {
        document.getElementById(`opt-${selectedOption}`).classList.add('is-correct');
    } else {
        if (selectedOption) document.getElementById(`opt-${selectedOption}`).classList.add('is-wrong');
        document.getElementById(`opt-${q.answer}`).classList.add('is-correct');
    }
    
    document.getElementById('explanation-area').innerHTML = `
        <div class="explanation-box">
            <strong>Gi·∫£i th√≠ch:</strong><br>${q.explanation}
        </div>`;
}

function toggleInfo() {
    if (!filteredQuestions[currentIndexInSet]) return;
    if (!isConfirmed) {
        showAnswerUI();
    } else {
        isConfirmed = false;
        resetInfoBtn();
        document.getElementById('explanation-area').innerHTML = '';
        document.querySelectorAll('.option-item').forEach(el => el.classList.remove('is-correct', 'is-wrong'));
        if (selectedOption) document.getElementById(`opt-${selectedOption}`).classList.add('selected');
    }
}

function resetInfoBtn() {
    const btn = document.getElementById('info-btn');
    btn.classList.remove('active-nav');
    document.getElementById('eye-icon').innerText = "‚óé";
}

function switchTab(type) { currentTab = type; currentIndexInSet = 0; updateFilteredData(); }
function nextQuestion() { if (currentIndexInSet < filteredQuestions.length - 1) { currentIndexInSet++; renderQuestion(); } }
function prevQuestion() { if (currentIndexInSet > 0) { currentIndexInSet--; renderQuestion(); } }

window.addEventListener('DOMContentLoaded', () => {
    changeExamSet(document.getElementById('set-select').value);
});
</script>
</body>
</html>