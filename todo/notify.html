<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Simple SW Notification</title>
</head>
<body>
    <h1>Service Worker Notification</h1>
    <button onclick="sendNotification()">Hiển thị Hello World</button>

    <script>
        if ('serviceWorker' in navigator) {
            // Thêm v=... để trình duyệt luôn nạp bản mới nhất của sw.js
            navigator.serviceWorker.register('sw.js?v=' + Date.now())
            .then(reg => console.log('SW đã sẵn sàng!', reg))
            .catch(err => console.error('Lỗi đăng ký SW:', err));
        }

        async function sendNotification() {
            const permission = await Notification.requestPermission();
            console.log('Quyền thông báo:', permission);
            
            if (permission === 'granted') {
                navigator.serviceWorker.ready.then(reg => {
                    if (reg.active) {
                        console.log('Đang gửi tin nhắn tới SW...');
                        reg.active.postMessage('trigger-notify');
                    } else {
                        console.error('SW chưa active!');
                    }
                });
            } else {
                alert('Bạn phải Cho phép (Allow) thông báo trên trình duyệt!');
            }
        }
    </script>
</body>
</html>