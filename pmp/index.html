<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PMP Quiz iOS</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root { 
            --primary: #007AFF; --easy: #34C759; --medium: #FF9500; --hard: #FF3B30;
            --bg: #F2F2F7; --card: #FFFFFF; --text-main: #000000; --text-sub: #8E8E93;
        }
        body, html { margin: 0; padding: 0; height: 100%; width: 100vw; font-family: -apple-system, 'Inter', sans-serif; background: var(--bg); display: flex; flex-direction: column; overflow: hidden; -webkit-tap-highlight-color: transparent; }

        /* Header & Tabs */
        .top-section { background: rgba(255,255,255,0.9); backdrop-filter: blur(20px); border-bottom: 0.5px solid #C6C6C8; flex-shrink: 0; z-index: 100; }
        header { padding: 10px 16px; display: flex; justify-content: space-between; align-items: center; }
        header h3 { margin: 0; font-size: 17px; font-weight: 800; }
        .tab-box { display: grid; grid-template-columns: repeat(4, 1fr); padding: 8px 16px; gap: 4px; background: #E3E3E6; margin: 0 16px 10px; border-radius: 10px; }
        .tab-btn { border: none; padding: 8px 2px; border-radius: 8px; font-size: 10px; font-weight: 700; color: #3A3A3C; background: transparent; cursor: pointer; }
        .tab-btn.active { background: white; box-shadow: 0 3px 8px rgba(0,0,0,0.1); }
        .settings-panel { padding: 0 16px 10px; }
        select { width: 100%; border: none; padding: 10px; border-radius: 10px; font-size: 13px; font-weight: 600; background: #E3E3E6; outline: none; }

        /* Main Area */
        .main-display { flex-grow: 1; overflow-y: auto; padding: 12px; padding-bottom: 120px; }
        .q-card { background: var(--card); border-radius: 24px; padding: 18px; box-shadow: 0 8px 24px rgba(0,0,0,0.04); margin-bottom: 20px; position: relative; }
        
        /* Sticky Header inside Card */
        .q-sticky-header {
            position: sticky; top: -12px; z-index: 10;
            background: rgba(255,255,255,0.98); backdrop-filter: blur(10px);
            padding: 12px 16px; margin: -18px -18px 15px -18px;
            border-bottom: 1px solid #F2F2F7; border-radius: 20px 20px 0 0;
            display: flex; justify-content: space-between; align-items: center;
        }

        .level-selector { display: flex; gap: 8px; }
        .btn-level-big { 
            border: 2px solid transparent; padding: 10px 14px; border-radius: 12px; 
            font-size: 11px; font-weight: 800; cursor: pointer; background: #F2F2F7; color: #8E8E93;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .btn-level-big.active-hard { background: var(--hard); color: white; border-color: #BD2E26; box-shadow: inset 0 2px 4px rgba(0,0,0,0.2); }
        .btn-level-big.active-medium { background: var(--medium); color: white; border-color: #D67D00; box-shadow: inset 0 2px 4px rgba(0,0,0,0.2); }
        .btn-level-big.active-easy { background: var(--easy); color: white; border-color: #289E46; box-shadow: inset 0 2px 4px rgba(0,0,0,0.2); }

        .q-text { font-size: 17px; font-weight: 600; line-height: 1.5; margin: 15px 0; }
        .options-list { display: flex; flex-direction: column; gap: 10px; }
        .option-item { font-size: 15px; padding: 16px; background: #F9F9FB; border-radius: 14px; border: 2px solid transparent; transition: 0.2s; }
        .option-item.selected { border-color: var(--primary); background: #EBF5FF; font-weight: 600; color: var(--primary); }
        .option-item.is-correct { background: #E8F5E9 !important; border-color: var(--easy) !important; color: #2E7D32 !important; font-weight: 700; }
        .option-item.is-wrong { background: #FFEBEE !important; border-color: var(--hard) !important; color: #C62828 !important; }

        #confirm-btn { width: 100%; margin-top: 20px; padding: 16px; border-radius: 14px; border: none; background: var(--primary); color: white; font-size: 15px; font-weight: 800; display: none; }

        /* Bottom Bar */
        .iphone-bar { 
            height: 84px; background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(20px); border-top: 0.5px solid rgba(0,0,0,0.1);
            display: flex; align-items: flex-start; justify-content: space-around;
            position: fixed; bottom: 0; width: 100%; z-index: 200; padding: 10px 10px 30px; box-sizing: border-box;
        }
        .tab-item { flex: 1; border: none; background: transparent; display: flex; flex-direction: column; align-items: center; color: #8E8E93; cursor: pointer; }
        .tab-item.active-nav { color: var(--primary); font-weight: 700; }
        .tab-item i { font-style: normal; font-size: 24px; margin-bottom: 2px; }
    </style>

    <script src="data1.js"></script>
    <script src="data2.js"></script>
    <script src="data3.js"></script>
</head>
<body>

<div class="top-section">
    <header><h3>PMP Master</h3><div id="set-label">...</div></header>
    <div class="tab-box">
        <button class="tab-btn active" data-type="todo" onclick="switchTab('todo')">M·ªöI</button>
        <button class="tab-btn" data-type="Easy" onclick="switchTab('Easy')">D·ªÑ</button>
        <button class="tab-btn" data-type="Medium" onclick="switchTab('Medium')">V·ª™A</button>
        <button class="tab-btn" data-type="Hard" onclick="switchTab('Hard')">KH√ì</button>
    </div>
    <div class="settings-panel">
        <select id="set-select" onchange="changeExamSet(this.value)">
            <option value="DATA_SET_1">ƒê·ªÅ thi s·ªë 01</option>
            <option value="DATA_SET_2">ƒê·ªÅ thi s·ªë 02</option>
            <option value="DATA_SET_3">ƒê·ªÅ thi s·ªë 03</option>
        </select>
    </div>
</div>

<div class="main-display" id="display-area"></div>

<div class="iphone-bar">
    <button class="tab-item" onclick="prevQuestion()"><i>‚Äπ</i><small>Tr∆∞·ªõc</small></button>
    <button class="tab-item" id="info-btn" onclick="toggleInfo()">
        <i id="eye-icon">‚óé</i><small id="info-txt">Hi·ªán ƒë√°p √°n</small>
    </button>
    <button class="tab-item" onclick="nextQuestion()"><i>‚Ä∫</i><small>Ti·∫øp theo</small></button>
</div>

<script>
// Bi·∫øn l∆∞u tr·ªØ to√†n c·ª•c
let pmpData = []; 
let filteredQuestions = [];
let currentIndexInSet = 0;
let currentTab = 'todo';
let selectedOption = null;
let isConfirmed = false;
let currentSetName = ""; 
const STORAGE_PREFIX = "PMP_V5_";

// H√†m ƒëi·ªÅu khi·ªÉn khi ch·ªçn Select
function changeExamSet(setVarName) {
    // setVarName l√∫c n√†y l√† chu·ªói "DATA_SET_1", "DATA_SET_2"...
    // window[setVarName] s·∫Ω truy c·∫≠p v√†o bi·∫øn var ƒë√£ nh√∫ng t·ª´ file .js
    if (window[setVarName]) {
        pmpData = window[setVarName];
        currentSetName = setVarName;
        document.getElementById('set-label').innerText = setVarName.replace('_', ' ');
        currentIndexInSet = 0;
        updateFilteredData();
    } else {
        alert("L·ªói: Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu " + setVarName + ". H√£y ki·ªÉm tra file .js ƒë√£ nh√∫ng ƒë√∫ng ch∆∞a.");
    }
}

function updateFilteredData() {
    const stored = JSON.parse(localStorage.getItem(STORAGE_PREFIX + currentSetName) || "{}");
    filteredQuestions = pmpData.filter(q => {
        const level = stored[q.id];
        return currentTab === 'todo' ? !level : level === currentTab;
    });

    const counts = { todo: 0, Easy: 0, Medium: 0, Hard: 0 };
    pmpData.forEach(q => {
        const level = stored[q.id];
        if (!level) counts.todo++; else counts[level]++;
    });

    document.querySelectorAll('.tab-btn').forEach(btn => {
        const type = btn.getAttribute('data-type');
        btn.innerText = `${type==='todo'?'M·ªöI':type.toUpperCase()} (${counts[type]})`;
        btn.classList.toggle('active', type === currentTab);
    });
    renderQuestion();
}

function renderQuestion() {
    const area = document.getElementById('display-area');
    const q = filteredQuestions[currentIndexInSet];
    
    // Reset Bottom Bar
    document.getElementById('info-btn').classList.remove('active-nav');
    document.getElementById('info-txt').innerText = "Hi·ªán ƒë√°p √°n";
    document.getElementById('eye-icon').innerText = "‚óé";

    if (!q) {
        area.innerHTML = `<div style="text-align:center; padding:100px 20px; color:#8E8E93;">üéâ H·∫øt c√¢u h·ªèi trong m·ª•c n√†y.</div>`;
        return;
    }
    
    selectedOption = null;
    isConfirmed = false;
    const stored = JSON.parse(localStorage.getItem(STORAGE_PREFIX + currentSetName) || "{}");
    const level = stored[q.id];

    let opts = '';
    for (const [key, val] of Object.entries(q.options)) {
        opts += `<div class="option-item" id="opt-${key}" onclick="selectOption('${key}')"><strong>${key}.</strong> ${val}</div>`;
    }

    area.innerHTML = `
        <div class="q-card">
            <div class="q-sticky-header">
                <span style="font-size:12px; font-weight:700; color:#8E8E93;">ID #${q.id}</span>
                <div class="level-selector">
                    <button class="btn-level-big ${level==='Hard'?'active-hard':''}" onclick="setLevel('${q.id}', 'Hard')">KH√ì</button>
                    <button class="btn-level-big ${level==='Medium'?'active-medium':''}" onclick="setLevel('${q.id}', 'Medium')">V·ª™A</button>
                    <button class="btn-level-big ${level==='Easy'?'active-easy':''}" onclick="setLevel('${q.id}', 'Easy')">D·ªÑ</button>
                </div>
            </div>
            <div class="q-text">${q.question}</div>
            <div class="options-list">${opts}</div>
            <button id="confirm-btn" onclick="confirmAnswer()">X√ÅC NH·∫¨N ƒê√ÅP √ÅN</button>
            <div id="explanation-box"></div>
        </div>`;
    area.scrollTo(0,0);
}

function selectOption(key) {
    if (isConfirmed) return;
    selectedOption = key;
    document.querySelectorAll('.option-item').forEach(el => el.classList.remove('selected'));
    document.getElementById(`opt-${key}`).classList.add('selected');
    document.getElementById('confirm-btn').style.display = 'block';
}

function confirmAnswer() {
    if (!selectedOption || isConfirmed) return;
    isConfirmed = true;
    const q = filteredQuestions[currentIndexInSet];
    document.getElementById('confirm-btn').style.display = 'none';
    
    if (selectedOption === q.answer) {
        document.getElementById(`opt-${selectedOption}`).classList.add('is-correct');
    } else {
        document.getElementById(`opt-${selectedOption}`).classList.add('is-wrong');
        document.getElementById(`opt-${q.answer}`).classList.add('is-correct');
    }
    
    document.getElementById('info-btn').classList.add('active-nav');
    document.getElementById('info-txt').innerText = "ƒêang hi·ªán";
    document.getElementById('eye-icon').innerText = "‚óâ";
    
    document.getElementById('explanation-box').innerHTML = `
        <div class="info-panel">
            <div class="explanation"><strong>Gi·∫£i th√≠ch:</strong> ${q.explanation}</div>
        </div>`;
}

function setLevel(id, level) {
    const key = STORAGE_PREFIX + currentSetName;
    const stored = JSON.parse(localStorage.getItem(key) || "{}");
    if (stored[id] === level) delete stored[id]; else stored[id] = level;
    localStorage.setItem(key, JSON.stringify(stored));
    updateFilteredData();
}

function switchTab(type) { currentTab = type; currentIndexInSet = 0; updateFilteredData(); }
function toggleInfo() { if (!isConfirmed) { const q = filteredQuestions[currentIndexInSet]; if (q) { selectedOption = q.answer; confirmAnswer(); } } }
function nextQuestion() { if (currentIndexInSet < filteredQuestions.length - 1) { currentIndexInSet++; renderQuestion(); } }
function prevQuestion() { if (currentIndexInSet > 0) { currentIndexInSet--; renderQuestion(); } }

// T·ª± ƒë·ªông load b·ªô ƒë·∫ßu ti√™n khi m·ªü trang
window.onload = () => changeExamSet(document.getElementById('set-select').value);
</script>
</body>
</html>