<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>PMP Master Pro - Carousel Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <script src="data1.js"></script>
    <script src="data2.js"></script>
    <script src="data3.js"></script>

    <style>
        :root { 
            --primary: #007AFF; --easy: #28CD41; --medium: #FF9500; --hard: #FF3B30;
            --bg: #F2F2F7; --card: #FFFFFF; --text-main: #1C1C1E; --text-sub: #8E8E93;
        }
        
        body, html { 
            margin: 0; padding: 0; height: 100%; width: 100vw; 
            font-family: -apple-system, 'Inter', sans-serif; 
            background-color: var(--bg); display: flex; flex-direction: column; 
            overflow: hidden; 
        }

        /* --- HEADER --- */
        .system-header { 
            background: white; border-bottom: 0.5px solid rgba(0,0,0,0.1); 
            flex-shrink: 0; z-index: 1000; padding-top: env(safe-area-inset-top);
        }
        .nav-row { padding: 8px 16px; display: flex; justify-content: space-between; align-items: center; }
        .brand { font-size: 16px; font-weight: 900; color: var(--text-main); }
        
        .filter-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; padding: 8px 12px; }
        .tab-pill {
            border: 2px solid transparent; padding: 8px; border-radius: 10px; 
            font-size: 11px; font-weight: 700; background: #E5E5EA; 
            color: #3A3A3C; text-align: center; cursor: pointer;
        }
        .tab-pill.active { background: var(--primary); color: white; border-color: var(--primary); }

        /* --- CAROUSEL VIEWPORT --- */
        .content-viewport { flex-grow: 1; position: relative; overflow: hidden; display: flex; align-items: center; }
        .carousel-container {
            display: flex; width: 100%; height: 95%;
            transition: transform 0.3s cubic-bezier(0.25, 1, 0.5, 1);
            will-change: transform;
        }
        .main-card { 
            min-width: 100%; height: 100%; padding: 0 12px; box-sizing: border-box;
        }
        .card-inner {
            background: var(--card); height: 100%; border-radius: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05); overflow-y: auto;
            position: relative; padding: 20px; box-sizing: border-box;
        }

        /* --- QUESTION UI --- */
        .q-tag-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .difficulty-tags { display: flex; gap: 5px; }
        .diff-btn { 
            font-size: 9px; padding: 4px 8px; border-radius: 6px; font-weight: 800;
            border: 1.5px solid #EEE; color: #8E8E93; background: white;
        }
        .diff-btn.active[data-type="Easy"] { background: var(--easy); color: white; border-color: var(--easy); }
        .diff-btn.active[data-type="Medium"] { background: var(--medium); color: white; border-color: var(--medium); }
        .diff-btn.active[data-type="Hard"] { background: var(--hard); color: white; border-color: var(--hard); }

        .q-text { font-size: 16px; font-weight: 600; line-height: 1.5; color: var(--text-main); margin-bottom: 20px; }
        .option-item { 
            font-size: 14px; padding: 14px; background: #F2F2F7; border-radius: 14px; 
            margin-bottom: 10px; border: 2px solid transparent; transition: 0.2s;
        }
        .option-item.selected { border-color: var(--primary); background: #E5F1FF; }
        .option-item.correct { background: #EFFFF3; border-color: var(--easy); color: #1A8B31; font-weight: 700; }

        .note-area { margin-top: 15px; }
        .note-input {
            width: 100%; border: 1px solid #E5E5EA; border-radius: 10px;
            padding: 10px; font-size: 13px; font-family: inherit; resize: none; background: #FAFAFA;
        }

        /* --- TRANSLATION OVERLAY --- */
        #trans-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.4); z-index: 3000; display: none;
            align-items: center; justify-content: center; padding: 20px;
        }
        .trans-box {
            background: #1C1C1E; color: white; width: 100%; max-width: 400px;
            border-radius: 15px; padding: 20px; position: relative;
        }
        .trans-box h4 { margin: 0 0 10px 0; color: var(--easy); font-size: 12px; }

        /* --- BOTTOM NAV (6 BUTTONS) --- */
        .bottom-nav { 
            height: 75px; background: white; border-top: 0.5px solid rgba(0,0,0,0.1);
            display: grid; grid-template-columns: repeat(6, 1fr); gap: 2px;
            padding: 5px 5px env(safe-area-inset-bottom);
        }
        .nav-btn {
            border: 1.5px solid #E5E5EA; background: white; border-radius: 8px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            color: #8E8E93; cursor: pointer; font-size: 10px; font-weight: 700; gap: 2px;
        }
        .nav-btn.active { border-color: var(--primary); color: var(--primary); background: #F0F7FF; }
        .nav-btn i { font-style: normal; font-size: 14px; }
        .nav-btn .count { font-size: 9px; opacity: 0.7; }
    </style>
</head>
<body>

<div id="trans-overlay" onclick="this.style.display='none'">
    <div class="trans-box" onclick="event.stopPropagation()">
        <h4>B·∫¢N D·ªäCH TI·∫æNG VI·ªÜT</h4>
        <div id="trans-text">...</div>
    </div>
</div>

<header class="system-header">
    <div class="nav-row">
        <div class="brand">PMP MASTER PRO</div>
        <select id="set-select" onchange="changeSet(this.value)" style="border:none; font-weight:800; color:var(--primary); background:transparent; font-size:14px;">
            <option value="DATA_SET_1">ƒê·ªÄ THI 01</option>
            <option value="DATA_SET_2">ƒê·ªÄ THI 02</option>
            <option value="DATA_SET_3">ƒê·ªÄ THI 03</option>
        </select>
    </div>
    <div class="filter-grid">
        <div class="tab-pill" id="tab-todo" onclick="switchTab('todo')">M·ªöI</div>
        <div class="tab-pill" id="tab-done" onclick="switchTab('done')">ƒê√É H·ªåC</div>
        <div class="tab-pill" id="tab-notdone" onclick="switchTab('notdone')">CH∆ØA H·ªåC</div>
    </div>
</header>

<main class="content-viewport" id="viewport">
    <div class="carousel-container" id="carousel"></div>
</main>

<nav class="bottom-nav">
    <div class="nav-btn" onclick="movePrev()"><i>‚èÆ</i>TR∆Ø·ªöC</div>
    <div class="nav-btn" id="btn-show" onclick="toggleAnswer()"><i>üëÅ</i>ƒê√ÅP √ÅN</div>
    <div class="nav-btn" id="foot-Easy" onclick="filterByDiff('Easy')">D·ªÑ<div class="count" id="cnt-Easy">0</div></div>
    <div class="nav-btn" id="foot-Medium" onclick="filterByDiff('Medium')">V·ª™A<div class="count" id="cnt-Medium">0</div></div>
    <div class="nav-btn" id="foot-Hard" onclick="filterByDiff('Hard')">KH√ì<div class="count" id="cnt-Hard">0</div></div>
    <div class="nav-btn" onclick="moveNext()"><i>‚è≠</i>TI·∫æP</div>
</nav>

<script>
let state = {
    set: localStorage.getItem('pmp_set') || 'DATA_SET_1',
    tab: localStorage.getItem('pmp_tab') || 'todo',
    diffFilter: null,
    index: 0,
    history: JSON.parse(localStorage.getItem('pmp_history') || '{}') // {qid: {ans, diff, note}}
};

let currentQuestions = [];
let startX = 0;
let currentTranslate = 0;

// --- D·ªäCH THU·∫¨T ---
document.addEventListener('selectionchange', () => {
    const text = window.getSelection().toString().trim();
    if (text.length > 3) {
        clearTimeout(window.tTimer);
        window.tTimer = setTimeout(() => translateText(text), 800);
    }
});

async function translateText(text) {
    const overlay = document.getElementById('trans-overlay');
    const box = document.getElementById('trans-text');
    overlay.style.display = 'flex';
    box.innerText = "ƒêang d·ªãch...";
    try {
        const res = await fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=en&tl=vi&dt=t&q=${encodeURIComponent(text)}`);
        const data = await res.json();
        box.innerText = data[0].map(x => x[0]).join('');
    } catch (e) { box.innerText = "Kh√¥ng th·ªÉ k·∫øt n·ªëi d·ªãch v·ª• d·ªãch."; }
}

// --- CORE LOGIC ---
function changeSet(val) {
    state.set = val;
    localStorage.setItem('pmp_set', val);
    state.index = 0;
    loadData();
}

function loadData() {
    const raw = window[state.set] || [];
    const history = state.history;

    // Filter by Top Tab
    currentQuestions = raw.filter(q => {
        const h = history[q.id];
        if (state.tab === 'done') return h && h.ans;
        if (state.tab === 'notdone') return h && !h.ans;
        return true; // M·ªõi
    });

    // Filter by Difficulty if selected
    if (state.diffFilter) {
        currentQuestions = currentQuestions.filter(q => history[q.id]?.diff === state.diffFilter);
    }

    updateCounts(raw);
    renderCarousel();
    updateUI();
}

function updateCounts(raw) {
    const diffs = {Easy: 0, Medium: 0, Hard: 0};
    raw.forEach(q => {
        const d = state.history[q.id]?.diff;
        if (d) diffs[d]++;
    });
    document.getElementById('cnt-Easy').innerText = diffs.Easy;
    document.getElementById('cnt-Medium').innerText = diffs.Medium;
    document.getElementById('cnt-Hard').innerText = diffs.Hard;
}

function renderCarousel() {
    const container = document.getElementById('carousel');
    container.innerHTML = currentQuestions.map((q, idx) => {
        const h = state.history[q.id] || {};
        return `
        <div class="main-card" data-idx="${idx}">
            <div class="card-inner">
                <div class="q-tag-row">
                    <span style="font-size:11px; font-weight:800; color:var(--primary)">C√ÇU ${idx+1}/${currentQuestions.length}</span>
                    <div class="difficulty-tags">
                        ${['Easy', 'Medium', 'Hard'].map(d => `
                            <div class="diff-btn ${h.diff === d ? 'active' : ''}" 
                                 onclick="setDiff(${q.id}, '${d}')" data-type="${d}">${d.toUpperCase()}</div>
                        `).join('')}
                    </div>
                </div>
                <div class="q-text">${q.question}</div>
                <div class="options">
                    ${Object.entries(q.options).map(([k, v]) => `
                        <div class="option-item ${h.ans === k ? 'selected' : ''}" 
                             id="opt-${q.id}-${k}" onclick="selectAns(${q.id}, '${k}')">
                             <b>${k}.</b> ${v}
                        </div>
                    `).join('')}
                </div>
                <div id="ans-${q.id}" style="display:none; margin-top:15px; font-size:13px; color:#555; background:#F8F8F8; padding:12px; border-radius:10px; border-left:4px solid var(--primary)">
                    <b>Gi·∫£i th√≠ch:</b> ${q.explanation}
                </div>
                <div class="note-area">
                    <textarea class="note-input" placeholder="Ghi ch√∫ c√¢u n√†y..." onchange="saveNote(${q.id}, this.value)">${h.note || ''}</textarea>
                </div>
            </div>
        </div>`;
    }).join('');
    gotoPage(state.index);
}

function selectAns(qid, key) {
    if (!state.history[qid]) state.history[qid] = {};
    // Toggle logic
    state.history[qid].ans = (state.history[qid].ans === key) ? null : key;
    localStorage.setItem('pmp_history', JSON.stringify(state.history));
    loadData(); // Re-filter and render
}

function setDiff(qid, level) {
    if (!state.history[qid]) state.history[qid] = {};
    state.history[qid].diff = level;
    localStorage.setItem('pmp_history', JSON.stringify(state.history));
    loadData();
}

function saveNote(qid, text) {
    if (!state.history[qid]) state.history[qid] = {};
    state.history[qid].note = text;
    localStorage.setItem('pmp_history', JSON.stringify(state.history));
}

function toggleAnswer() {
    const q = currentQuestions[state.index];
    if (!q) return;
    const panel = document.getElementById(`ans-${q.id}`);
    const correctOpt = document.getElementById(`opt-${q.id}-${q.answer}`);
    
    const isShowing = panel.style.display === 'block';
    panel.style.display = isShowing ? 'none' : 'block';
    if (!isShowing) correctOpt.classList.add('correct');
    else correctOpt.classList.remove('correct');
    
    document.getElementById('btn-show').classList.toggle('active', !isShowing);
}

// --- NAVIGATION ---
function switchTab(t) {
    state.tab = t;
    localStorage.setItem('pmp_tab', t);
    state.index = 0;
    loadData();
}

function filterByDiff(d) {
    state.diffFilter = (state.diffFilter === d) ? null : d;
    state.index = 0;
    loadData();
}

function gotoPage(idx) {
    if (idx < 0 || idx >= currentQuestions.length) return;
    state.index = idx;
    const carousel = document.getElementById('carousel');
    carousel.style.transform = `translateX(-${idx * 100}%)`;
    
    // Reset ƒë√°p √°n khi qua trang m·ªõi
    document.getElementById('btn-show').classList.remove('active');
}

function moveNext() { gotoPage(state.index + 1); }
function movePrev() { gotoPage(state.index - 1); }

function updateUI() {
    // Tabs highlight
    document.querySelectorAll('.tab-pill').forEach(el => el.classList.remove('active'));
    document.getElementById(`tab-${state.tab.replace('-','')}`)?.classList.add('active');
    
    // Bottom buttons highlight
    document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
    if (state.diffFilter) {
        document.getElementById(`foot-${state.diffFilter}`).classList.add('active');
    }
    document.getElementById('set-select').value = state.set;
}

// --- SWIPE GESTURE ---
const viewport = document.getElementById('viewport');
viewport.addEventListener('touchstart', e => { startX = e.touches[0].clientX; }, {passive: true});
viewport.addEventListener('touchend', e => {
    let diff = startX - e.changedTouches[0].clientX;
    if (Math.abs(diff) > 50) {
        if (diff > 0) moveNext(); else movePrev();
    }
}, {passive: true});

window.onload = () => {
    loadData();
};
</script>
</body>
</html>