<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Test Notification SW</title>
    <style>
        body { font-family: sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; background: #f0f2f5; gap: 20px; }
        .card { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); text-align: center; }
        button { padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .btn-test { background: #4facfe; color: white; margin-top: 10px; }
        .btn-perm { background: #55efc4; color: #2d3436; }
        .status { margin-top: 15px; font-size: 14px; color: #636e72; }
    </style>
</head>
<body>

<div class="card">
    <h2>Thử nghiệm Thông báo</h2>
    <p>Nhấn nút dưới đây để kích hoạt gửi notify ngay lập tức</p>
    
    <button class="btn-perm" onclick="requestPerm()">1. Cấp quyền Notify</button>
    <br>
    <button class="btn-test" onclick="triggerNow()">2. Gửi Notify Ngay (Test)</button>

    <div class="status" id="statusText">Trạng thái: Đang chờ...</div>
</div>

<script>
    const statusText = document.getElementById('statusText');

    // Đăng ký Service Worker
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('sw.js').then(reg => {
            statusText.innerText = "Trạng thái: SW đã đăng ký thành công!";
        });
    }

    async function requestPerm() {
        const permission = await Notification.requestPermission();
        statusText.innerText = `Quyền thông báo: ${permission}`;
    }

    function triggerNow() {
        if (!navigator.serviceWorker.controller) {
            statusText.innerText = "Lỗi: SW chưa sẵn sàng. Hãy F5 trang!";
            return;
        }
        
        // Gửi tin nhắn đến Service Worker để nó chạy hàm checkAndNotify ngay
        navigator.serviceWorker.controller.postMessage({
            action: 'test_notify_now'
        });
        
        statusText.innerText = "Đã gửi lệnh kích hoạt đến Service Worker!";
    }
</script>
</body>
</html>